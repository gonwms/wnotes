<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="style.css">
	<title>üçè KCAL</title>
</head>
<body>

	<p class="question">¬øQu√© tu quieres comer?</p>
	<div class="feebackSpeech">
	</div>
	<ul class="list">
		<!-- content -->
		<li><h3>sand√≠a</h3>
		<p>8kcal | 12gr Prote√≠na | 18gr Hidrato | 8gr Grasa</p></li>
	</ul>

<script>

		var comidas = [
			{
				nombre:"br√≥coli",
				KCALxGR:20,
				proteina100gr:5,
				hidratos100gr:80,
				grasa100gr:0
			},
			{
				nombre:"pollo",
				KCALxGR:100,
				proteina100gr:80,
				hidratos100gr:5,
				grasa100gr:0
			},
			{
				nombre:"aceite",
				KCALxGR:100,
				proteina100gr:0,
				hidratos100gr:0,
				grasa100gr:100
			}
		]

		window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

		const recognition = new SpeechRecognition();
		recognition.interimResults = true;
		recognition.lang = 'es-ES';
		
		//on error
		recognition.onerror = function (event) {
			console.log(event.error);
		};
		//steps flags
		let step1ok = false;
		let step2ok = false;
		let step3ok = false;
		
		//Attach speech  to DOM 
		const feebackSpeech = document.querySelector('.feebackSpeech');
		const question = document.querySelector('.question');
		const lista = document.querySelector('.list');
		let p = document.createElement('p');
		var li = document.createElement('LI');
		feebackSpeech.appendChild(p);
		


		recognition.addEventListener('result', e => {
			
			const transcript = Array.from(e.results).map(result => result[0]).map(result => result.transcript).join('');		
			var match = comidas.find(comida =>{
					return comida.nombre == transcript;
			})
			
			//feedback speech
			p.textContent = transcript;		
			

			if (e.results[0].isFinal) {			

				//step 1
				if(match && !step1ok){
					handlerStep1(match)
					console.log(step1ok)	
				}
				//step 2
				else if  (step1ok && !step2ok){
					handlerStep2(transcript)
				}
				//step 3
				else if (step1ok && step2ok){
					handlerStep3(transcript)
				}
				else{
					console.log('NO');
					
					noMatch()		
				}	
			}

		});

		recognition.start();
		recognition.addEventListener('end', recognition.start);

		

		function handlerStep1(match){
			li = document.createElement('LI');
			li.innerHTML = `
			<h3>${match.nombre}</h3>
			<p>${match.KCALxGR}kcal | ${match.proteina100gr}gr Prote√≠na | ${match.hidratos100gr}gr Hidrato | ${match.grasa100gr}gr Grasa</p>
			`
			step1ok = true;

			//render
			p.classList.add('match')
			lista.appendChild(li);	
		}
		function handlerStep2(transcript){
			if (transcript == 'calor√≠as' || transcript == 'calor√≠a'){
						console.log('kcal')
					}
			else if (transcript == 'gramos' || transcript == 'gramo'){
				console.log('gramos')
			}
			step2ok = true
		}
		function handlerStep3(transcript){
			console.log(transcript)
			step1ok = false
			step2ok = false
		}


		function noMatch(){
			p.textContent = "‚ö†Ô∏è No encontrado"
			//render
			feebackSpeech.appendChild(p);

		}

</script>





<style>
		*{
			margin:0;
			padding: 0;
		}
		body{
			background: #dddddd
		}
		.feebackSpeech {
			max-width: 500px;
			padding: 10px;
		}
		.match{
			color: green
		}
		.feebackSpeech{
			background: bisque;
		}
		.question{
			text-align: center
		}
		.list{
			list-style: none;
			padding: 0
		}
		.list li{
			background: #fff;
			box-shadow: 0 2px 2px #00000011;
			padding: 20px;
			border-radius: 3px;
			max-width: 350px;;
		}
		.list h3{
			margin:0
		}
		.list p{
			font-size: 13px
		}
</style>

</body>

</html>